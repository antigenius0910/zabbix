---
resource_types:
- name: artifactory
  type: docker-image
  source:
    repository: pivotalservices/artifactory-resource

resources:
- name: artifactory-repository
  type: artifactory
  check_every: 1m
  source:
    endpoint: http://192.168.144.6:8081/artifactory
    repository: "/example-repo-local"
    regex: zabbix-agent_(?<version>.*).deb
    username: yen
    password: SS6:Z3+sWMbr476n
- name: workspace-repo
  type: git
  source:
    uri: https://github.com/antigenius0910/zabbix.git
    branch: genctl

jobs:
  - name: job-test-zabbix
    public: true
    plan:
      - get: workspace-repo
      - task: zabbix-app-tests
        config:
          platform: linux
          image_resource:
            type: docker-image
            source: {repository: golang, tag: 1.14.15-stretch}
          inputs:
          - name: workspace-repo
          outputs:
          - name: workspace-repo-deb

          run:
            path: workspace-repo/hack/ci/build.sh

      - put: artifactory-repository
        params: { file: ./workspace-repo-deb/zabbix-agent_*_amd64.deb } 
